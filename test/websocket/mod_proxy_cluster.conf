LoadModule watchdog_module modules/mod_watchdog.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule proxy_hcheck_module modules/mod_proxy_hcheck.so
LoadModule slotmem_shm_module modules/mod_slotmem_shm.so
LoadModule manager_module modules/mod_manager.so
LoadModule proxy_cluster_module modules/mod_proxy_cluster.so

ProxyPreserveHost On

Listen 8090
ServerName httpd-mod_proxy_cluster
ManagerBalancerName mycluster
WSUpgradeHeader websocket
EnableWsTunnel

<IfModule !lbmethod_cluster_module>
    CreateBalancers 0
    EnableOptions On
</IfModule>

<VirtualHost *:8090>
    EnableMCMPReceive
    <Location />
        Require host .mod_proxy_cluster_testsuite_net
        # _gateway is the hostname used through the docker port forward into the custom network
        Require host _gateway
        Require local
    </Location>
    <Location /mod_cluster_manager>
        SetHandler mod_cluster-manager
        # _gateway is the hostname used through the docker port forward into the custom network
        Require host _gateway
        Require local
    </Location>
</VirtualHost>

<IfModule lbmethod_cluster_module>
    <Proxy "balancer://mycluster">
        ProxySet growth=10
        ProxySet lbmethod=cluster
    </Proxy>
</IfModule>
