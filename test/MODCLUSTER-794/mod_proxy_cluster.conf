LoadModule watchdog_module modules/mod_watchdog.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule proxy_hcheck_module modules/mod_proxy_hcheck.so
LoadModule slotmem_shm_module modules/mod_slotmem_shm.so
LoadModule manager_module modules/mod_manager.so
LoadModule proxy_cluster_module modules/mod_proxy_cluster.so

<IfModule !lbmethod_cluster_module>
  UseAlias On
</IfModule>

ProxyPreserveHost On

Listen 6666
ServerName localhost
ManagerBalancerName mycluster
EnableWsTunnel
WSUpgradeHeader websocket

<IfModule !lbmethod_cluster_module>
  CreateBalancers 0
  EnableOptions On
</IfModule>

<VirtualHost *:6666>
  EnableMCMPReceive
  <Location />
    Require ip 127.0.0.
    Require ip ::1
    # This one is used in GH Actions
    Require ip 172.17.
  </Location>
  <Location /mod_cluster_manager>
    SetHandler mod_cluster-manager
    Require ip 127.0.0.
    Require ip ::1
    # This one is used in GH Actions
    Require ip 172.17.
  </Location>
</VirtualHost>
  
<IfModule lbmethod_cluster_module>
  <Proxy "balancer://mycluster">
    ProxySet growth=10
    ProxySet lbmethod=cluster
  </Proxy>
</IfModule>

# This is the default value, but let's go with the explicit here
Maxnode 20
